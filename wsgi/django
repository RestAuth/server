import os, sys
os.environ['DJANGO_SETTINGS_MODULE'] = 'RestAuth.settings'

import django.core.handlers.wsgi
application = django.core.handlers.wsgi.WSGIHandler()

def check_password(environ, user, password):
        try:
		# set up environment:
		from RestAuth.Services.models import Service
		from django import db
        	db.reset_queries()
		if 'REMOTE_ADDR' in environ:
			host = environ['REMOTE_ADDR']
		else:
			sys.stderr.write( "Error: Could not get remote host from environment!" )
			sys.stderr.flush()
			return False

		# verify service
		serv = Service.objects.get( username=user )
		if serv.verify( password, host ):
			return True
		else:
			return False
	except Service.DoesNotExist:
		return None
	except Exception, e:
		import sys
		sys.stderr.write( "Error: Uncought exception: %s"%(type(e)) )
		sys.stderr.write( "    %s"%(e) )
		sys.stderr.flush()
		return None
        finally:
                db.connection.close()
